{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-11-02T13:44:38.691972Z", "invocation_id": "ef20808c-16ae-4042-b83d-b53b3bdf2b92", "invocation_started_at": "2025-11-02T13:44:35.228544Z", "env": {}}, "results": [{"status": "error", "timing": [{"name": "compile", "started_at": "2025-11-02T13:44:38.480781Z", "completed_at": "2025-11-02T13:44:38.519426Z"}, {"name": "execute", "started_at": "2025-11-02T13:44:38.522647Z", "completed_at": "2025-11-02T13:44:38.620068Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.16312217712402344, "adapter_response": {}, "message": "Database Error in model dim_location (models/messud/dim_location.sql)\n  Received ClickHouse exception, code: 558, server response: Code: 558. DB::Exception: Expected ALL or DISTINCT in SelectWithUnion query, because setting (union_default_mode) is empty: While processing SELECT Continent, Country, State, County, NULL AS Latitude, NULL AS Longitude FROM aphis_locations UNION SELECT Continent, Country, State, County, Latitude, Longitude FROM gbif_locations. (EXPECTED_ALL_OR_DISTINCT) (version 25.9.3.48 (official build)) (for url http://clickhouse-server-project:8123)", "failures": null, "unique_id": "model.clickhouse_dbt_project.dim_location", "compiled": true, "compiled_code": "/* Model SQL for dim.Organism.\nJoins together data from both GBIF and Aphis datasets. \nFor GBIF, staging is not used. In the case of APHIs, the staging model stg_aphis_long, which was used to change the data into long format, will be referenced.\n\nMacro get_state_name() is used to convert state codes into full state names.\n*/\n\n/* Selecting the APHIS data. \nThe APHIS data should currently only contain data collected from the US, thus there are no columns indicating country or continent.\nIf the macro does not identify a state as one of the US states, then the country and continent are set as unknown, because then the state may not represent a US state.\n*/\n\nWITH aphis_locations AS (\n\tSELECT \n\t\t sampling_county AS County,\n\t\t \nCASE\n    WHEN state_code = 'AL' THEN 'Alabama'\n    WHEN state_code = 'AK' THEN 'Alaska'\n    WHEN state_code = 'AZ' THEN 'Arizona'\n    WHEN state_code = 'AR' THEN 'Arkansas'\n    WHEN state_code = 'CA' THEN 'California'\n    WHEN state_code = 'CO' THEN 'Colorado'\n    WHEN state_code = 'CT' THEN 'Connecticut'\n    WHEN state_code = 'DE' THEN 'Delaware'\n    WHEN state_code = 'FL' THEN 'Florida'\n    WHEN state_code = 'GA' THEN 'Georgia'\n    WHEN state_code = 'HI' THEN 'Hawaii'\n    WHEN state_code = 'ID' THEN 'Idaho'\n    WHEN state_code = 'IL' THEN 'Illinois'\n    WHEN state_code = 'IN' THEN 'Indiana'\n    WHEN state_code = 'IA' THEN 'Iowa'\n    WHEN state_code = 'KS' THEN 'Kansas'\n    WHEN state_code = 'KY' THEN 'Kentucky'\n    WHEN state_code = 'LA' THEN 'Louisiana'\n    WHEN state_code = 'ME' THEN 'Maine'\n    WHEN state_code = 'MD' THEN 'Maryland'\n    WHEN state_code = 'MA' THEN 'Massachusetts'\n    WHEN state_code = 'MI' THEN 'Michigan'\n    WHEN state_code = 'MN' THEN 'Minnesota'\n    WHEN state_code = 'MS' THEN 'Mississippi'\n    WHEN state_code = 'MO' THEN 'Missouri'\n    WHEN state_code = 'MT' THEN 'Montana'\n    WHEN state_code = 'NE' THEN 'Nebraska'\n    WHEN state_code = 'NV' THEN 'Nevada'\n    WHEN state_code = 'NH' THEN 'New Hampshire'\n    WHEN state_code = 'NJ' THEN 'New Jersey'\n    WHEN state_code = 'NM' THEN 'New Mexico'\n    WHEN state_code = 'NY' THEN 'New York'\n    WHEN state_code = 'NC' THEN 'North Carolina'\n    WHEN state_code = 'ND' THEN 'North Dakota'\n    WHEN state_code = 'OH' THEN 'Ohio'\n    WHEN state_code = 'OK' THEN 'Oklahoma'\n    WHEN state_code = 'OR' THEN 'Oregon'\n    WHEN state_code = 'PA' THEN 'Pennsylvania'\n    WHEN state_code = 'RI' THEN 'Rhode Island'\n    WHEN state_code = 'SC' THEN 'South Carolina'\n    WHEN state_code = 'SD' THEN 'South Dakota'\n    WHEN state_code = 'TN' THEN 'Tennessee'\n    WHEN state_code = 'TX' THEN 'Texas'\n    WHEN state_code = 'UT' THEN 'Utah'\n    WHEN state_code = 'VT' THEN 'Vermont'\n    WHEN state_code = 'VA' THEN 'Virginia'\n    WHEN state_code = 'WA' THEN 'Washington'\n    WHEN state_code = 'WV' THEN 'West Virginia'\n    WHEN state_code = 'WI' THEN 'Wisconsin'\n    WHEN state_code = 'WY' THEN 'Wyoming'\n    ELSE 'Unknown'\nEND\n AS State, -- Using the macro get_state_name() to get the full state name.\n\t\tCASE\n\t\t \tWHEN state_code IS NULL OR \nCASE\n    WHEN state_code = 'AL' THEN 'Alabama'\n    WHEN state_code = 'AK' THEN 'Alaska'\n    WHEN state_code = 'AZ' THEN 'Arizona'\n    WHEN state_code = 'AR' THEN 'Arkansas'\n    WHEN state_code = 'CA' THEN 'California'\n    WHEN state_code = 'CO' THEN 'Colorado'\n    WHEN state_code = 'CT' THEN 'Connecticut'\n    WHEN state_code = 'DE' THEN 'Delaware'\n    WHEN state_code = 'FL' THEN 'Florida'\n    WHEN state_code = 'GA' THEN 'Georgia'\n    WHEN state_code = 'HI' THEN 'Hawaii'\n    WHEN state_code = 'ID' THEN 'Idaho'\n    WHEN state_code = 'IL' THEN 'Illinois'\n    WHEN state_code = 'IN' THEN 'Indiana'\n    WHEN state_code = 'IA' THEN 'Iowa'\n    WHEN state_code = 'KS' THEN 'Kansas'\n    WHEN state_code = 'KY' THEN 'Kentucky'\n    WHEN state_code = 'LA' THEN 'Louisiana'\n    WHEN state_code = 'ME' THEN 'Maine'\n    WHEN state_code = 'MD' THEN 'Maryland'\n    WHEN state_code = 'MA' THEN 'Massachusetts'\n    WHEN state_code = 'MI' THEN 'Michigan'\n    WHEN state_code = 'MN' THEN 'Minnesota'\n    WHEN state_code = 'MS' THEN 'Mississippi'\n    WHEN state_code = 'MO' THEN 'Missouri'\n    WHEN state_code = 'MT' THEN 'Montana'\n    WHEN state_code = 'NE' THEN 'Nebraska'\n    WHEN state_code = 'NV' THEN 'Nevada'\n    WHEN state_code = 'NH' THEN 'New Hampshire'\n    WHEN state_code = 'NJ' THEN 'New Jersey'\n    WHEN state_code = 'NM' THEN 'New Mexico'\n    WHEN state_code = 'NY' THEN 'New York'\n    WHEN state_code = 'NC' THEN 'North Carolina'\n    WHEN state_code = 'ND' THEN 'North Dakota'\n    WHEN state_code = 'OH' THEN 'Ohio'\n    WHEN state_code = 'OK' THEN 'Oklahoma'\n    WHEN state_code = 'OR' THEN 'Oregon'\n    WHEN state_code = 'PA' THEN 'Pennsylvania'\n    WHEN state_code = 'RI' THEN 'Rhode Island'\n    WHEN state_code = 'SC' THEN 'South Carolina'\n    WHEN state_code = 'SD' THEN 'South Dakota'\n    WHEN state_code = 'TN' THEN 'Tennessee'\n    WHEN state_code = 'TX' THEN 'Texas'\n    WHEN state_code = 'UT' THEN 'Utah'\n    WHEN state_code = 'VT' THEN 'Vermont'\n    WHEN state_code = 'VA' THEN 'Virginia'\n    WHEN state_code = 'WA' THEN 'Washington'\n    WHEN state_code = 'WV' THEN 'West Virginia'\n    WHEN state_code = 'WI' THEN 'Wisconsin'\n    WHEN state_code = 'WY' THEN 'Wyoming'\n    ELSE 'Unknown'\nEND\n = 'Unknown' THEN 'Unknown' -- If State is unknown, Continent will be set as \"Unknown\", otherwise it will be \"North America\".\n\t\t\tELSE 'North America'\n\t\tEND AS Continent,\n\t\tCASE\n\t\t\tWHEN state_code IS NULL OR \nCASE\n    WHEN state_code = 'AL' THEN 'Alabama'\n    WHEN state_code = 'AK' THEN 'Alaska'\n    WHEN state_code = 'AZ' THEN 'Arizona'\n    WHEN state_code = 'AR' THEN 'Arkansas'\n    WHEN state_code = 'CA' THEN 'California'\n    WHEN state_code = 'CO' THEN 'Colorado'\n    WHEN state_code = 'CT' THEN 'Connecticut'\n    WHEN state_code = 'DE' THEN 'Delaware'\n    WHEN state_code = 'FL' THEN 'Florida'\n    WHEN state_code = 'GA' THEN 'Georgia'\n    WHEN state_code = 'HI' THEN 'Hawaii'\n    WHEN state_code = 'ID' THEN 'Idaho'\n    WHEN state_code = 'IL' THEN 'Illinois'\n    WHEN state_code = 'IN' THEN 'Indiana'\n    WHEN state_code = 'IA' THEN 'Iowa'\n    WHEN state_code = 'KS' THEN 'Kansas'\n    WHEN state_code = 'KY' THEN 'Kentucky'\n    WHEN state_code = 'LA' THEN 'Louisiana'\n    WHEN state_code = 'ME' THEN 'Maine'\n    WHEN state_code = 'MD' THEN 'Maryland'\n    WHEN state_code = 'MA' THEN 'Massachusetts'\n    WHEN state_code = 'MI' THEN 'Michigan'\n    WHEN state_code = 'MN' THEN 'Minnesota'\n    WHEN state_code = 'MS' THEN 'Mississippi'\n    WHEN state_code = 'MO' THEN 'Missouri'\n    WHEN state_code = 'MT' THEN 'Montana'\n    WHEN state_code = 'NE' THEN 'Nebraska'\n    WHEN state_code = 'NV' THEN 'Nevada'\n    WHEN state_code = 'NH' THEN 'New Hampshire'\n    WHEN state_code = 'NJ' THEN 'New Jersey'\n    WHEN state_code = 'NM' THEN 'New Mexico'\n    WHEN state_code = 'NY' THEN 'New York'\n    WHEN state_code = 'NC' THEN 'North Carolina'\n    WHEN state_code = 'ND' THEN 'North Dakota'\n    WHEN state_code = 'OH' THEN 'Ohio'\n    WHEN state_code = 'OK' THEN 'Oklahoma'\n    WHEN state_code = 'OR' THEN 'Oregon'\n    WHEN state_code = 'PA' THEN 'Pennsylvania'\n    WHEN state_code = 'RI' THEN 'Rhode Island'\n    WHEN state_code = 'SC' THEN 'South Carolina'\n    WHEN state_code = 'SD' THEN 'South Dakota'\n    WHEN state_code = 'TN' THEN 'Tennessee'\n    WHEN state_code = 'TX' THEN 'Texas'\n    WHEN state_code = 'UT' THEN 'Utah'\n    WHEN state_code = 'VT' THEN 'Vermont'\n    WHEN state_code = 'VA' THEN 'Virginia'\n    WHEN state_code = 'WA' THEN 'Washington'\n    WHEN state_code = 'WV' THEN 'West Virginia'\n    WHEN state_code = 'WI' THEN 'Wisconsin'\n    WHEN state_code = 'WY' THEN 'Wyoming'\n    ELSE 'Unknown'\nEND\n = 'Unknown' THEN 'Unknown' -- If State is unknown, Country will be set as \"Unknown\", otherwise it will be \"US\"\n\t\t\tELSE 'US'\n\t\tEND AS Country\n\tFROM `messud`.`stg_aphis_long`\n\tGROUP BY County, State, Country, Continent -- Grouping the data together.\n),\n\n-- Selecting the GBIF location data\ngbif_locations AS (\n\tSELECT \n\t\treplaceAll(continent,'_', ' ') AS Continent, \n\t\tcountryCode AS Country,\n\t\tstateProvince AS State,\n\t\tcounty AS County,\n\t\tdecimalLatitude AS Latitude,\n\t\tdecimalLongitude AS Longitude\n\tFROM `messud`.`stg_gbif`\n\tGROUP BY County, State, Country, Continent, decimalLatitude, decimalLongitude\n),\n\n-- Combining the two datasets together.\nlocationsCombined AS (\n\tSELECT Continent, Country, State, County, NULL AS Latitude, NULL AS Longitude FROM aphis_locations\n\tUNION\n\tSELECT Continent, Country, State, County, Latitude, Longitude from gbif_locations\n)\n\n-- Extracting the required data for dim.location.\nSELECT\n\tlower(hex(MD5(toString(coalesce(cast(Continent as String), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(Country as String), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(State as String), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(County as String), '_dbt_utils_surrogate_key_null_') )))) AS LocationKey,\n\tContinent,\n\tCountry,\n\tState,\n\tCounty,\n\tLatitude,\n\tLongitude \nFROM locationsCombined\n\nORDER BY Continent, Country, State, County", "relation_name": "`messud`.`dim_location`", "batch_results": null}], "elapsed_time": 1.1095714569091797, "args": {"require_explicit_package_overrides_for_builtin_materializations": true, "log_level": "info", "validate_macro_args": false, "which": "run", "macro_debugging": false, "source_freshness_run_project_hooks": true, "vars": {}, "introspect": true, "require_all_warnings_handled_by_warn_error": false, "select": ["dim_location"], "show_resource_report": false, "require_batched_execution_for_custom_microbatch_strategy": false, "use_colors": true, "log_format_file": "debug", "send_anonymous_usage_stats": true, "partial_parse": true, "require_generic_test_arguments_property": true, "empty": false, "indirect_selection": "eager", "use_fast_test_edges": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "favor_state": false, "require_yaml_configuration_for_mf_time_spines": false, "print": true, "printer_width": 80, "show_all_deprecations": false, "quiet": false, "state_modified_compare_vars": false, "log_format": "default", "require_resource_names_without_spaces": true, "state_modified_compare_more_unrendered_values": false, "strict_mode": false, "upload_to_artifacts_ingest_api": false, "use_colors_file": true, "write_json": true, "invocation_command": "dbt run --select dim_location", "require_nested_cumulative_type_params": false, "partial_parse_file_diff": true, "exclude": [], "skip_nodes_if_on_run_start_fails": false, "cache_selected_only": false, "log_path": "/dbt/logs", "static_parser": true, "project_dir": "/dbt", "log_file_max_bytes": 10485760, "profiles_dir": "/dbt", "version_check": true, "defer": false, "populate_cache": true, "log_level_file": "debug"}}